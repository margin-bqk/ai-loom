# LOOM 默认配置文件
# 版本: 1.0.0
# 注意：这是一个示例配置文件，实际使用时请根据需要进行修改

# LLM 提供商配置
llm_providers:
  openai:
    type: openai
    api_key: ${OPENAI_API_KEY:}
    model: gpt-3.5-turbo
    temperature: 0.7
    max_tokens: 1000
    timeout: 30
    max_retries: 3
    retry_delay: 1.0
    fallback_enabled: true
    enabled: true
    connection_pool_size: 5
    enable_caching: true
    cache_ttl: 300

  deepseek:
    type: deepseek
    api_key: ${DEEPSEEK_API_KEY:}
    base_url: https://api.deepseek.com
    model: deepseek-chat
    thinking_enabled: false
    temperature: 1.0
    max_tokens: 4096
    timeout: 60
    enabled: true

# Provider 选择策略
provider_selection:
  default_provider: openai
  fallback_order:
    - openai
    - deepseek
    - ollama

  # 基于会话类型的 Provider 选择
  session_type_mapping:
    creative_writing:
      preferred_provider: openai
      preferred_model: gpt-4

    world_building:
      preferred_provider: deepseek
      preferred_model: deepseek-chat

    quick_chat:
      preferred_provider: openai
      preferred_model: gpt-3.5-turbo

    chinese_content:
      preferred_provider: deepseek
      preferred_model: deepseek-chat
      fallback_to: openai

  # 成本优化策略
  cost_optimization:
    enabled: true
    monthly_budget: 50.0
    alert_threshold: 0.8
    auto_switch_to_cheaper: true
    token_counting: true

# 记忆配置
memory:
  backend: sqlite
  db_path: ./data/loom_memory.db
  vector_store_enabled: false
  max_memories_per_session: 1000
  auto_summarize: true
  summarization_interval_days: 7

# 会话默认配置
session_defaults:
  default_canon_path: ./canon
  default_llm_provider: openai
  max_turns: null # 无限制
  auto_save_interval: 5
  intervention_allowed: true
  retcon_allowed: true

# 叙事解释器配置
narrative:
  enabled: true
  consistency_check_enabled: true
  continuity_check_enabled: true
  auto_summarize: true
  summarization_interval_turns: 10
  narrative_arc_tracking: true
  max_narrative_arcs: 5
  default_narrative_tone: neutral
  default_narrative_pace: normal
  consistency_threshold: 0.7
  max_continuity_issues: 5
  auto_archive: true
  archive_interval_turns: 50
  max_archive_versions: 10
  export_format: markdown

# 性能配置
performance:
  max_prompt_length: 8000
  max_memories_per_prompt: 10
  enable_response_caching: true
  cache_size_mb: 100

# 安全配置
security:
  allow_file_system_access: true
  max_session_duration_hours: 24
  intervention_rate_limit: 10
  require_justification_for_retcon: true

# 监控配置
monitoring:
  enable_metrics: true
  metrics_port: 9090
  enable_tracing: false
  log_retention_days: 30

# 运行时配置
max_concurrent_turns: 3
log_level: INFO
data_dir: ./data
cache_enabled: true
cache_ttl_minutes: 60

# 插件配置
plugins: {}
